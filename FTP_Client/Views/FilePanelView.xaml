<UserControl x:Class="FTP_Client.Views.FilePanelView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converter="clr-namespace:FTP_Client.Converters"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             xmlns:enums="clr-namespace:FTP_Client.Enums"
             Foreground="{StaticResource TextBrush}">

    <UserControl.Resources>
        <converter:FolderSizeConverter x:Key="FolderSizeConverter" />
        <converter:DateConverter x:Key="DateConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Margin="10,10,10,0" 
                    Orientation="Horizontal">

            <Button Command="{Binding GoBackCommand}" 
                    Style="{StaticResource IconButton}">
                <Path Data="M4,0 L0,4 L4,8" 
                      Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      StrokeThickness="1.5" />
            </Button>

            <Button Command="{Binding GoForwardCommand}" 
                    Style="{StaticResource IconButton}">
                <Path Data="M0,0 L4,4 L0,8" 
                      Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" 
                      StrokeThickness="1.5" />
            </Button>

            <Button Command="{Binding GoHomeCommand}" 
                    Style="{StaticResource IconButton}">
                <Path Data="M 2 8 L 8 2 L 14 8 M 4 7 L 4 14 L 12 14 L 12 7"
                      Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                      StrokeThickness="1.2"
                      Width="16" 
                      Height="16" 
                      Stretch="Uniform"/>
            </Button>

            <Border VerticalAlignment="Center"
                    Margin="10,0"
                    Background="{StaticResource PanelBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="4"
                    MinWidth="200"
                    Padding="8,4">

                <TextBlock Text="{Binding CurrentPath}"
                           VerticalAlignment="Center" />
            </Border>

        </StackPanel>

        <Border Grid.Row="1" Margin="10,5,10,0"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <Button ToolTip="Создать папку">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                            <Setter Property="Command" Value="{Binding DataContext.CreateLocalDirectoryCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding PanelType}" Value="{x:Static enums:PanelType.Server}">
                                    <Setter Property="Command" Value="{Binding DataContext.CreateServerDirectoryCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    
                    <Viewbox Width="12" Height="12">
                        <Path Data="M 1 2 L 7 2 L 9 4 L 15 4 L 15 13 L 1 13 Z" Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.5"/>
                    </Viewbox>
                </Button>

                <Button ToolTip="Удалить">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                            <Setter Property="Command" Value="{Binding DataContext.DeleteLocalItemCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding PanelType}" Value="{x:Static enums:PanelType.Server}">
                                    <Setter Property="Command" Value="{Binding DataContext.DeleteServerItemCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Viewbox Width="12" Height="12">
                        <Path Data="M 2 4 L 14 4 L 13 15 L 3 15 Z M 4 1 L 12 1 L 12 3 L 4 3 Z M 0 2 L 16 2" Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.2"/>
                    </Viewbox>
                </Button>

                <Button ToolTip="Переименовать">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                            <Setter Property="Command" Value="{Binding DataContext.RenameLocalItemCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding PanelType}" Value="{x:Static enums:PanelType.Server}">
                                    <Setter Property="Command" Value="{Binding DataContext.RenameServerItemCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Viewbox Width="12" Height="12">
                        <Path Data="M 2 14 L 14 14 M 3 11 L 13 11 M 8 0 L 5 11 M 8 0 L 11 11 M 4 7 L 12 7" Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.2"/>
                    </Viewbox>
                </Button>

                <Button ToolTip="Обновить">
                    <Button.Style>
                        <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                            <Setter Property="Command" Value="{Binding DataContext.RefreshLocalPanelCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding PanelType}" Value="{x:Static enums:PanelType.Server}">
                                    <Setter Property="Command" Value="{Binding DataContext.RefreshServerPanelCommand, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Viewbox Width="12" Height="12">
                        <Path Data="M 14.9 8.8 C 14.5 5.5 11.6 3 8 3 C 5.2 3 2.9 4.7 1.9 7 L 4 7 L 0 11 L 4 15 L 1.5 15 C 2.9 12.3 5.3 10.5 8.2 10.5 C 10.9 10.5 13.2 12.2 14 14.5 L 12 14.5 L 16 18.5 L 20 14.5 L 17 14.5 C 16.3 12.6 15.3 10.7 14.9 8.8 Z" Stroke="{Binding Path=Foreground, RelativeSource={RelativeSource AncestorType=Button}}" StrokeThickness="1.2"/>
                    </Viewbox>
                </Button>


            </StackPanel>
        </Border>

        <DataGrid Grid.Row="2" Margin="10"
                  ItemsSource="{Binding FilesAndFolders}"
                  SelectedItem="{Binding SelectedFileItem}"
                  Style="{StaticResource BaseDataGrid}"
                  AutoGenerateColumns="False"
                  CanUserSortColumns="True"
                  IsReadOnly="True"
                  SelectionMode="Single"
                  SelectionUnit="FullRow">

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="MouseDoubleClick">
                    <i:InvokeCommandAction Command="{Binding ItemDoubleClickCommand}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Наименование" 
                                    Binding="{Binding FileName}" 
                                    MinWidth="200" />

                <DataGridTextColumn Header="Дата изменения" 
                                    Binding="{Binding LastModified, Converter={StaticResource DateConverter}}"
                                    Width="Auto" />

                <DataGridTextColumn Header="Тип" 
                                    Binding="{Binding FileType}" 
                                    MinWidth="50" />

                <DataGridTextColumn Header="Размер" 
                                    Binding="{Binding Size, Converter={StaticResource FolderSizeConverter}}" 
                                    MinWidth="50" />
            </DataGrid.Columns>
        </DataGrid>
    </Grid>

</UserControl>